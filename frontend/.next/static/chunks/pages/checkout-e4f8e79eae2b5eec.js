(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[222],{5248:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return r(1071)}])},1842:function(e,t,r){"use strict";async function safeFetchJson(e,t){try{let r=await fetch(e,Object.assign({credentials:"include"},t||{}));if(!r.ok){let e=await r.text().catch(()=>null),t=Error("HTTP "+r.status+" "+r.statusText);throw t.status=r.status,t.body=e,t}return await r.json()}catch(t){throw console.error("API fetch error",e,t),t}}r.d(t,{S:function(){return swrFetcher}});let swrFetcher=e=>safeFetchJson(e)},8910:function(e,t,r){"use strict";function toUrlEncoded(e){return Object.keys(e).map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]||"")).join("&")}async function postUrlEncoded(e,t){return fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:toUrlEncoded(t),credentials:"include"})}function validateEmail(e){return/\S+@\S+\.\S+/.test(e)}function validateRequired(e){return"string"==typeof e?e.trim().length>0:!!e}r.d(t,{QK:function(){return validateRequired},RR:function(){return postUrlEncoded},oH:function(){return validateEmail}})},1071:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Checkout}});var n=r(5893),s=r(3454),i=r(9044),d=r(9734),o=r(7294),c=r(8910),a=r(1842);function Checkout(){let{data:e,error:t}=(0,d.ZP)("/api/cart",a.S),[r,l]=(0,o.useState)("momo"),[u,m]=(0,o.useState)(""),[h,p]=(0,o.useState)(""),[y,j]=(0,o.useState)(null);async function placeOrder(){if(j("processing"),"momo"===r&&!(0,c.QK)(u))return j("enter_momo");if("card"===r&&!(0,c.QK)(h))return j("enter_card");try{if("momo"===r){let e=await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_method:"momo",momo_number:u}),credentials:"include"}),t=await e.json();t.orderId?j("success:"+t.orderId):j("error")}else{let e=await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_method:"card",card_number:h}),credentials:"include"}),t=await e.json();t.stripeUrl?window.location=t.stripeUrl:t.orderId?j("success:"+t.orderId):j("error")}}catch(e){j("error")}}let x=e?e.reduce((e,t)=>e+t.price*t.qty,0).toFixed(2):"0.00";return(0,n.jsxs)("div",{children:[(0,n.jsx)(s.Z,{}),(0,n.jsx)("main",{className:"container",children:(0,n.jsxs)("div",{className:"glass",style:{padding:20,marginTop:18},children:[(0,n.jsx)("h1",{children:"Checkout"}),t?(0,n.jsx)("div",{className:"muted",children:"Could not load cart"}):e?0===e.length?(0,n.jsx)("p",{className:"muted",children:"Your cart is empty"}):(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 320px",gap:16},children:[(0,n.jsx)("div",{children:e.map(e=>(0,n.jsxs)("div",{className:"card",style:{display:"flex",justifyContent:"space-between",padding:12},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:e.title}),(0,n.jsxs)("div",{className:"muted",children:["Qty: ",e.qty]})]}),(0,n.jsxs)("div",{style:{fontWeight:700},children:["GHS ",(e.price*e.qty).toFixed(2)]})]},e.id))}),(0,n.jsxs)("aside",{className:"summary",children:[(0,n.jsx)("h3",{children:"Order Summary"}),(0,n.jsxs)("div",{className:"row total",children:[(0,n.jsx)("div",{children:"Total"}),(0,n.jsxs)("div",{children:["GHS ",x]})]}),(0,n.jsxs)("div",{style:{marginTop:12},children:[(0,n.jsxs)("div",{style:{marginBottom:8},children:[(0,n.jsxs)("label",{style:{display:"block",marginBottom:6},children:[(0,n.jsx)("input",{type:"radio",name:"method",checked:"momo"===r,onChange:()=>l("momo")})," Mobile money"]}),"momo"===r&&(0,n.jsx)("div",{children:(0,n.jsx)("input",{placeholder:"Momo number",value:u,onChange:e=>m(e.target.value),style:{padding:8,width:"100%",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"}})})]}),(0,n.jsxs)("div",{style:{marginBottom:8},children:[(0,n.jsxs)("label",{style:{display:"block",marginBottom:6},children:[(0,n.jsx)("input",{type:"radio",name:"method",checked:"card"===r,onChange:()=>l("card")})," Card"]}),"card"===r&&(0,n.jsx)("div",{children:(0,n.jsx)("input",{placeholder:"Card number (test)",value:h,onChange:e=>p(e.target.value),style:{padding:8,width:"100%",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"}})})]}),(0,n.jsx)("div",{style:{marginTop:10},children:(0,n.jsx)("button",{className:"cta",onClick:placeOrder,style:{width:"100%"},children:"Place order"})}),y&&(0,n.jsx)("div",{style:{marginTop:12},children:y.startsWith("success:")?(0,n.jsxs)("div",{className:"notice success",children:["Order placed: ",y.split(":")[1]]}):"processing"===y?(0,n.jsx)("div",{className:"muted",children:"Processing..."}):"enter_momo"===y?(0,n.jsx)("div",{style:{color:"crimson"},children:"Enter Momo number"}):"enter_card"===y?(0,n.jsx)("div",{style:{color:"crimson"},children:"Enter card number"}):(0,n.jsx)("div",{style:{color:"crimson"},children:"Payment failed"})})]})]})]}):(0,n.jsx)("p",{children:"Loading..."})]})}),(0,n.jsx)(i.Z,{})]})}}},function(e){e.O(0,[664,133,997,774,888,179],function(){return e(e.s=5248)}),_N_E=e.O()}]);